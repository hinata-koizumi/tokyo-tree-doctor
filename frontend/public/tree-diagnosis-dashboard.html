<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ê®πÊú®Ë®∫Êñ≠„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans JP', sans-serif;
            background: #f8f9fa;
            color: #2c3e50;
            overflow: hidden;
        }

        /* „Éà„ÉÉ„Éó„Éê„Éº */
        .topbar {
            height: 60px;
            background: linear-gradient(135deg, #2c5282 0%, #2d7a4e 100%);
            display: flex;
            align-items: center;
            padding: 0 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            position: relative;
            z-index: 1000;
        }

        .topbar h1 {
            color: white;
            font-size: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .topbar .logo {
            width: 32px;
            height: 32px;
            background: rgba(255,255,255,0.2);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        /* „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„Éä */
        .main-container {
            display: flex;
            height: calc(100vh - 60px);
            position: relative;
        }

        /* Â∑¶„Çµ„Ç§„Éâ„Éë„Éç„É´ */
        .sidebar {
            width: 380px;
            background: white;
            box-shadow: 2px 0 8px rgba(0,0,0,0.05);
            padding: 24px;
            overflow-y: auto;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateX(-20px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* KPI„Ç´„Éº„Éâ */
        .kpi-section {
            margin-bottom: 32px;
        }

        .section-title {
            font-size: 14px;
            color: #6b7280;
            margin-bottom: 16px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .kpi-cards {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 24px;
        }

        .kpi-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .kpi-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }

        .kpi-card.danger {
            background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
            border-color: #fca5a5;
        }

        .kpi-card.warning {
            background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
            border-color: #fbbf24;
        }

        .kpi-card.safe {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border-color: #86efac;
        }

        .kpi-value {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .kpi-card.danger .kpi-value {
            color: #dc2626;
        }

        .kpi-card.warning .kpi-value {
            color: #f59e0b;
        }

        .kpi-card.safe .kpi-value {
            color: #10b981;
        }

        .kpi-label {
            font-size: 12px;
            color: #6b7280;
            font-weight: 500;
        }

        /* ÈÄ≤Êçó„Éê„Éº */
        .progress-bar {
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
            display: flex;
        }

        .progress-segment {
            transition: width 0.5s ease;
        }

        .progress-segment.danger {
            background: #dc2626;
        }

        .progress-segment.warning {
            background: #f59e0b;
        }

        .progress-segment.safe {
            background: #10b981;
        }

        /* ÂÑ™ÂÖàÂ∫¶„É™„Çπ„Éà */
        .priority-section {
            margin-top: 32px;
        }

        .priority-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .priority-item {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 16px;
            transition: all 0.3s ease;
            cursor: pointer;
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .priority-item:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            transform: translateX(4px);
        }

        .priority-number {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
        }

        .priority-content {
            flex: 1;
        }

        .priority-title {
            font-weight: 600;
            margin-bottom: 4px;
            color: #1f2937;
        }

        .priority-details {
            font-size: 12px;
            color: #6b7280;
            display: flex;
            gap: 12px;
        }

        .priority-badge {
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
        }

        .badge-danger {
            background: #fef2f2;
            color: #dc2626;
        }

        .badge-warning {
            background: #fffbeb;
            color: #f59e0b;
        }

        /* Âú∞Âõ≥„Ç≥„É≥„ÉÜ„Éä */
        .map-container {
            flex: 1;
            position: relative;
        }

        #map {
            width: 100%;
            height: 100%;
        }

        /* „Ç´„Çπ„Çø„É†„Éû„Éº„Ç´„Éº„Çπ„Çø„Ç§„É´ */
        .custom-marker {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .custom-marker:hover {
            transform: scale(1.2);
        }

        .marker-danger {
            background: #dc2626;
        }

        .marker-warning {
            background: #f59e0b;
        }

        .marker-safe {
            background: #10b981;
        }

        /* „Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„Çπ„Çø„Ç§„É´ */
        .leaflet-popup-content-wrapper {
            border-radius: 12px;
            padding: 0;
            overflow: hidden;
        }

        .popup-content {
            padding: 16px;
            min-width: 280px;
        }

        .popup-header {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 12px;
            color: #1f2937;
        }

        .popup-details {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 16px;
        }

        .popup-detail-row {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
        }

        .popup-detail-label {
            color: #6b7280;
        }

        .popup-detail-value {
            font-weight: 600;
            color: #1f2937;
        }

        .popup-action {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
        }

        .popup-action:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }

        /* „É¢„Éê„Ç§„É´ÂØæÂøú */
        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }

            .mobile-panel {
                position: absolute;
                bottom: 0;
                left: 0;
                right: 0;
                background: white;
                border-radius: 24px 24px 0 0;
                padding: 24px;
                box-shadow: 0 -4px 16px rgba(0,0,0,0.1);
                z-index: 1000;
                max-height: 50vh;
                overflow-y: auto;
            }

            .mobile-kpi-grid {
                display: grid;
                grid-template-columns: repeat(3, 1fr);
                gap: 12px;
                margin-bottom: 20px;
            }

            .mobile-kpi-item {
                text-align: center;
                padding: 12px;
                background: #f9fafb;
                border-radius: 12px;
            }

            .mobile-kpi-value {
                font-size: 24px;
                font-weight: 700;
                margin-bottom: 4px;
            }

            .mobile-kpi-label {
                font-size: 11px;
                color: #6b7280;
            }
        }

        /* „É≠„Éº„Éá„Ç£„É≥„Ç∞„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: none;
        }

        .loading-spinner {
            width: 48px;
            height: 48px;
            border: 4px solid #e5e7eb;
            border-top-color: #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- „Éà„ÉÉ„Éó„Éê„Éº -->
    <div class="topbar">
        <h1>
            <div class="logo">üå≥</div>
            Ê®πÊú®Ë®∫Êñ≠„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ
        </h1>
    </div>

    <!-- „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„Éä -->
    <div class="main-container">
        <!-- Â∑¶„Çµ„Ç§„Éâ„Éë„Éç„É´ -->
        <div class="sidebar">
            <!-- KPI„Çª„ÇØ„Ç∑„Éß„É≥ -->
            <div class="kpi-section">
                <h2 class="section-title">Ë®∫Êñ≠ÁµêÊûú„Çµ„Éû„É™„Éº</h2>
                
                <div class="kpi-cards">
                    <div class="kpi-card danger" onclick="filterMarkers('danger')">
                        <div class="kpi-value">8</div>
                        <div class="kpi-label">Âç±Èô∫</div>
                    </div>
                    <div class="kpi-card warning" onclick="filterMarkers('warning')">
                        <div class="kpi-value">15</div>
                        <div class="kpi-label">Ë¶ÅÊ≥®ÊÑè</div>
                    </div>
                    <div class="kpi-card safe" onclick="filterMarkers('safe')">
                        <div class="kpi-value">42</div>
                        <div class="kpi-label">ÂÅ•ÂÖ®</div>
                    </div>
                </div>

                <div class="progress-bar">
                    <div class="progress-segment danger" style="width: 12.3%"></div>
                    <div class="progress-segment warning" style="width: 23.1%"></div>
                    <div class="progress-segment safe" style="width: 64.6%"></div>
                </div>
            </div>

            <!-- ÂÑ™ÂÖàÂ∫¶„É™„Çπ„Éà -->
            <div class="priority-section">
                <h2 class="section-title">ÂØæÁ≠ñÂÑ™ÂÖàÂ∫¶ TOP 5</h2>
                
                <div class="priority-list">
                    <div class="priority-item" onclick="focusTree(35.6895, 139.6917)">
                        <div class="priority-number">1</div>
                        <div class="priority-content">
                            <div class="priority-title">ID: TR-2024-045</div>
                            <div class="priority-details">
                                <span>VARI: 0.12</span>
                                <span>Ê®πÈΩ¢: 85Âπ¥</span>
                                <span class="priority-badge badge-danger">Âç≥ÂØæÂøú</span>
                            </div>
                        </div>
                    </div>

                    <div class="priority-item" onclick="focusTree(35.6885, 139.6925)">
                        <div class="priority-number">2</div>
                        <div class="priority-content">
                            <div class="priority-title">ID: TR-2024-018</div>
                            <div class="priority-details">
                                <span>VARI: 0.18</span>
                                <span>Ê®πÈΩ¢: 72Âπ¥</span>
                                <span class="priority-badge badge-danger">Âç≥ÂØæÂøú</span>
                            </div>
                        </div>
                    </div>

                    <div class="priority-item" onclick="focusTree(35.6905, 139.6905)">
                        <div class="priority-number">3</div>
                        <div class="priority-content">
                            <div class="priority-title">ID: TR-2024-032</div>
                            <div class="priority-details">
                                <span>VARI: 0.25</span>
                                <span>Ê®πÈΩ¢: 68Âπ¥</span>
                                <span class="priority-badge badge-warning">Ë¶ÅÁõ£Ë¶ñ</span>
                            </div>
                        </div>
                    </div>

                    <div class="priority-item" onclick="focusTree(35.6875, 139.6935)">
                        <div class="priority-number">4</div>
                        <div class="priority-content">
                            <div class="priority-title">ID: TR-2024-089</div>
                            <div class="priority-details">
                                <span>VARI: 0.28</span>
                                <span>Ê®πÈΩ¢: 55Âπ¥</span>
                                <span class="priority-badge badge-warning">Ë¶ÅÁõ£Ë¶ñ</span>
                            </div>
                        </div>
                    </div>

                    <div class="priority-item" onclick="focusTree(35.6915, 139.6895)">
                        <div class="priority-number">5</div>
                        <div class="priority-content">
                            <div class="priority-title">ID: TR-2024-067</div>
                            <div class="priority-details">
                                <span>VARI: 0.32</span>
                                <span>Ê®πÈΩ¢: 48Âπ¥</span>
                                <span class="priority-badge badge-warning">ÂÆöÊúüË¶≥ÂØü</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Âú∞Âõ≥„Ç≥„É≥„ÉÜ„Éä -->
        <div class="map-container">
            <div id="map"></div>
            <div class="loading">
                <div class="loading-spinner"></div>
            </div>
        </div>

        <!-- „É¢„Éê„Ç§„É´Áî®„Éë„Éç„É´Ôºà768px‰ª•‰∏ã„ÅßË°®Á§∫Ôºâ -->
        <div class="mobile-panel" style="display: none;">
            <div class="mobile-kpi-grid">
                <div class="mobile-kpi-item">
                    <div class="mobile-kpi-value" style="color: #dc2626;">8</div>
                    <div class="mobile-kpi-label">Âç±Èô∫</div>
                </div>
                <div class="mobile-kpi-item">
                    <div class="mobile-kpi-value" style="color: #f59e0b;">15</div>
                    <div class="mobile-kpi-label">Ë¶ÅÊ≥®ÊÑè</div>
                </div>
                <div class="mobile-kpi-item">
                    <div class="mobile-kpi-value" style="color: #10b981;">42</div>
                    <div class="mobile-kpi-label">ÂÅ•ÂÖ®</div>
                </div>
            </div>
            <h3 style="font-size: 14px; margin-bottom: 12px; color: #6b7280;">ÂÑ™ÂÖàÂØæÂøú</h3>
            <div style="padding: 12px; background: #fef2f2; border-radius: 8px; border-left: 4px solid #dc2626;">
                <div style="font-weight: 600; margin-bottom: 4px;">TR-2024-045</div>
                <div style="font-size: 12px; color: #6b7280;">VARI: 0.12 | Âç≥ÂØæÂøúÊé®Â•®</div>
            </div>
        </div>
    </div>

    <script>
        // Leaflet„ÅåË™≠„ÅøËæº„Åæ„Çå„Çã„Åæ„ÅßÂæÖÊ©ü
        window.addEventListener('DOMContentLoaded', function() {
            // Âú∞Âõ≥„ÅÆÂàùÊúüÂåñ
            const map = L.map('map').setView([35.689, 139.692], 15);

        // „Çø„Ç§„É´„É¨„Ç§„É§„Éº„ÅÆËøΩÂä†
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© OpenStreetMap contributors',
            maxZoom: 19
        }).addTo(map);

        // „Çµ„É≥„Éó„É´„Éá„Éº„Çø
        const treeData = [
            // Âç±Èô∫„Å™Ê®πÊú®
            { id: 'TR-2024-045', lat: 35.6895, lng: 139.6917, status: 'danger', vari: 0.12, age: 85, height: 22, recommendation: 'Âç≥Â∫ß„ÅÆ‰ºêÊé°„ÇíÊé®Â•®' },
            { id: 'TR-2024-018', lat: 35.6885, lng: 139.6925, status: 'danger', vari: 0.18, age: 72, height: 18, recommendation: 'Âç≥Â∫ß„ÅÆ‰ºêÊé°„ÇíÊé®Â•®' },
            { id: 'TR-2024-091', lat: 35.6888, lng: 139.6912, status: 'danger', vari: 0.15, age: 78, height: 20, recommendation: 'Á∑äÊÄ•ÁÇπÊ§ú„ÅåÂøÖË¶Å' },
            { id: 'TR-2024-104', lat: 35.6892, lng: 139.6908, status: 'danger', vari: 0.20, age: 65, height: 19, recommendation: 'Âç≥Â∫ß„ÅÆÂØæÂøú„ÅåÂøÖË¶Å' },
            { id: 'TR-2024-127', lat: 35.6897, lng: 139.6903, status: 'danger', vari: 0.14, age: 82, height: 23, recommendation: '‰ºêÊé°„ÇíÊ§úË®é' },
            { id: 'TR-2024-135', lat: 35.6883, lng: 139.6928, status: 'danger', vari: 0.19, age: 70, height: 17, recommendation: 'Á∑äÊÄ•ÂØæÂøú„ÅåÂøÖË¶Å' },
            { id: 'TR-2024-142', lat: 35.6886, lng: 139.6922, status: 'danger', vari: 0.16, age: 75, height: 21, recommendation: 'Âç≥Â∫ß„ÅÆÁÇπÊ§ú„ÅåÂøÖË¶Å' },
            { id: 'TR-2024-156', lat: 35.6894, lng: 139.6915, status: 'danger', vari: 0.13, age: 88, height: 24, recommendation: '‰ºêÊé°„ÇíÂº∑„ÅèÊé®Â•®' },
            
            // Ë¶ÅÊ≥®ÊÑè„ÅÆÊ®πÊú®
            { id: 'TR-2024-032', lat: 35.6905, lng: 139.6905, status: 'warning', vari: 0.25, age: 68, height: 16, recommendation: '3„É∂Êúà‰ª•ÂÜÖ„ÅÆÂÜçË®∫Êñ≠' },
            { id: 'TR-2024-089', lat: 35.6875, lng: 139.6935, status: 'warning', vari: 0.28, age: 55, height: 15, recommendation: 'ÂÆöÊúüÁõ£Ë¶ñ„ÇíÁ∂ôÁ∂ö' },
            { id: 'TR-2024-067', lat: 35.6915, lng: 139.6895, status: 'warning', vari: 0.32, age: 48, height: 14, recommendation: '6„É∂ÊúàÂæå„Å´ÂÜçË©ï‰æ°' },
            { id: 'TR-2024-023', lat: 35.6878, lng: 139.6932, status: 'warning', vari: 0.30, age: 52, height: 15, recommendation: 'Êûù„ÅÆÂâ™ÂÆö„ÇíÊ§úË®é' },
            { id: 'TR-2024-078', lat: 35.6912, lng: 139.6898, status: 'warning', vari: 0.35, age: 45, height: 13, recommendation: 'ÁµåÈÅéË¶≥ÂØü„ÇíÁ∂ôÁ∂ö' },
            { id: 'TR-2024-056', lat: 35.6902, lng: 139.6902, status: 'warning', vari: 0.27, age: 60, height: 17, recommendation: 'Ê¨°ÂõûË®∫Êñ≠ÊôÇ„Å´ÈáçÁÇπÁ¢∫Ë™ç' },
            { id: 'TR-2024-034', lat: 35.6908, lng: 139.6892, status: 'warning', vari: 0.33, age: 42, height: 12, recommendation: 'ÊàêÈï∑Áä∂ÊÖã„ÇíÁõ£Ë¶ñ' },
            { id: 'TR-2024-098', lat: 35.6872, lng: 139.6938, status: 'warning', vari: 0.29, age: 58, height: 16, recommendation: 'ÂúüÂ£åÊîπËâØ„ÇíÊ§úË®é' },
            { id: 'TR-2024-112', lat: 35.6918, lng: 139.6888, status: 'warning', vari: 0.31, age: 50, height: 14, recommendation: 'ÂÆöÊúüÁöÑ„Å™Ë¶≥ÂØü„ÅåÂøÖË¶Å' },
            { id: 'TR-2024-076', lat: 35.6882, lng: 139.6918, status: 'warning', vari: 0.34, age: 46, height: 13, recommendation: 'ÊàêÈï∑‰øÉÈÄ≤Âá¶ÁΩÆ„ÇíÊ§úË®é' },
            { id: 'TR-2024-043', lat: 35.6898, lng: 139.6907, status: 'warning', vari: 0.26, age: 62, height: 18, recommendation: 'Êûù„ÅÆÊï¥ÁêÜ„ÅåÂøÖË¶Å' },
            { id: 'TR-2024-021', lat: 35.6876, lng: 139.6930, status: 'warning', vari: 0.36, age: 40, height: 11, recommendation: 'Ê†ÑÈ§äÁä∂ÊÖã„ÅÆÊîπÂñÑ' },
            { id: 'TR-2024-087', lat: 35.6910, lng: 139.6900, status: 'warning', vari: 0.28, age: 56, height: 15, recommendation: 'ÁóÖÂÆ≥Ëô´„ÅÆ‰∫àÈò≤Âá¶ÁΩÆ' },
            { id: 'TR-2024-065', lat: 35.6904, lng: 139.6896, status: 'warning', vari: 0.32, age: 47, height: 13, recommendation: 'ÂúüÂ£åÊ∞¥ÂàÜ„ÅÆÁÆ°ÁêÜ' },
            { id: 'TR-2024-054', lat: 35.6880, lng: 139.6920, status: 'warning', vari: 0.30, age: 53, height: 14, recommendation: 'Âë®Ëæ∫Áí∞Â¢É„ÅÆÊï¥ÂÇô' },
            
            // ÂÅ•ÂÖ®„Å™Ê®πÊú®Ôºà‰∏ÄÈÉ®„ÅÆ„ÅøË°®Á§∫Ôºâ
            { id: 'TR-2024-001', lat: 35.6900, lng: 139.6910, status: 'safe', vari: 0.68, age: 35, height: 12, recommendation: 'ÂïèÈ°å„Å™„Åó' },
            { id: 'TR-2024-002', lat: 35.6890, lng: 139.6920, status: 'safe', vari: 0.72, age: 28, height: 10, recommendation: 'ÂÅ•ÂÖ®„Å™Áä∂ÊÖã' },
            { id: 'TR-2024-003', lat: 35.6880, lng: 139.6915, status: 'safe', vari: 0.75, age: 32, height: 11, recommendation: 'ËâØÂ•Ω' },
            { id: 'TR-2024-004', lat: 35.6895, lng: 139.6925, status: 'safe', vari: 0.70, age: 30, height: 10, recommendation: 'ÂïèÈ°å„Å™„Åó' },
            { id: 'TR-2024-005', lat: 35.6885, lng: 139.6910, status: 'safe', vari: 0.78, age: 25, height: 9, recommendation: 'ÈùûÂ∏∏„Å´ÂÅ•ÂÖ®' },
            { id: 'TR-2024-006', lat: 35.6905, lng: 139.6915, status: 'safe', vari: 0.73, age: 33, height: 11, recommendation: 'ËâØÂ•Ω„Å™Áä∂ÊÖã' },
            { id: 'TR-2024-007', lat: 35.6875, lng: 139.6925, status: 'safe', vari: 0.69, age: 38, height: 12, recommendation: 'ÂÅ•ÂÖ®' },
            { id: 'TR-2024-008', lat: 35.6910, lng: 139.6905, status: 'safe', vari: 0.76, age: 27, height: 9, recommendation: 'ÂïèÈ°å„Å™„Åó' },
            { id: 'TR-2024-009', lat: 35.6870, lng: 139.6930, status: 'safe', vari: 0.71, age: 31, height: 10, recommendation: 'ËâØÂ•Ω' },
            { id: 'TR-2024-010', lat: 35.6915, lng: 139.6910, status: 'safe', vari: 0.74, age: 29, height: 10, recommendation: 'ÂÅ•ÂÖ®„Å™ÊàêÈï∑' },
            { id: 'TR-2024-011', lat: 35.6888, lng: 139.6905, status: 'safe', vari: 0.77, age: 26, height: 9, recommendation: 'ÈùûÂ∏∏„Å´ËâØÂ•Ω' },
            { id: 'TR-2024-012', lat: 35.6892, lng: 139.6895, status: 'safe', vari: 0.70, age: 34, height: 11, recommendation: 'ÂïèÈ°å„Å™„Åó' },
            { id: 'TR-2024-013', lat: 35.6878, lng: 139.6908, status: 'safe', vari: 0.72, age: 30, height: 10, recommendation: 'ÂÅ•ÂÖ®' },
            { id: 'TR-2024-014', lat: 35.6907, lng: 139.6920, status: 'safe', vari: 0.75, age: 28, height: 9, recommendation: 'ËâØÂ•Ω„Å™Áä∂ÊÖã' },
            { id: 'TR-2024-015', lat: 35.6873, lng: 139.6912, status: 'safe', vari: 0.68, age: 36, height: 12, recommendation: 'ÂïèÈ°å„Å™„Åó' }
        ];

        // „Éû„Éº„Ç´„Éº„Ç∞„É´„Éº„Éó
        const markerGroups = {
            danger: L.layerGroup(),
            warning: L.layerGroup(),
            safe: L.layerGroup()
        };

        // „Éû„Éº„Ç´„Éº„ÅÆ‰ΩúÊàê
        treeData.forEach(tree => {
            const markerIcon = L.divIcon({
                className: `custom-marker marker-${tree.status}`,
                iconSize: [24, 24]
            });

            const marker = L.marker([tree.lat, tree.lng], { icon: markerIcon });
            
            // „Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„ÅÆ‰ΩúÊàê
            const popupContent = `
                <div class="popup-content">
                    <div class="popup-header">Ê®πÊú® ${tree.id}</div>
                    <div class="popup-details">
                        <div class="popup-detail-row">
                            <span class="popup-detail-label">Áä∂ÊÖã</span>
                            <span class="popup-detail-value" style="color: ${
                                tree.status === 'danger' ? '#dc2626' : 
                                tree.status === 'warning' ? '#f59e0b' : '#10b981'
                            }">
                                ${tree.status === 'danger' ? 'Âç±Èô∫' : 
                                  tree.status === 'warning' ? 'Ë¶ÅÊ≥®ÊÑè' : 'ÂÅ•ÂÖ®'}
                            </span>
                        </div>
                        <div class="popup-detail-row">
                            <span class="popup-detail-label">VARIÂÄ§</span>
                            <span class="popup-detail-value">${tree.vari}</span>
                        </div>
                        <div class="popup-detail-row">
                            <span class="popup-detail-label">Ê®πÈΩ¢</span>
                            <span class="popup-detail-value">${tree.age}Âπ¥</span>
                        </div>
                        <div class="popup-detail-row">
                            <span class="popup-detail-label">Ê®πÈ´ò</span>
                            <span class="popup-detail-value">${tree.height}m</span>
                        </div>
                        <div class="popup-detail-row">
                            <span class="popup-detail-label">Êé®Â•®ÂØæÁ≠ñ</span>
                            <span class="popup-detail-value">${tree.recommendation}</span>
                        </div>
                    </div>
                    <button class="popup-action" onclick="showDetails('${tree.id}')">
                        Ë©≥Á¥∞„É¨„Éù„Éº„Éà„ÇíË°®Á§∫
                    </button>
                </div>
            `;
            
            marker.bindPopup(popupContent);
            markerGroups[tree.status].addLayer(marker);
        });

        // „Åô„Åπ„Å¶„ÅÆ„Éû„Éº„Ç´„Éº„ÇíÂú∞Âõ≥„Å´ËøΩÂä†
        Object.values(markerGroups).forEach(group => {
            group.addTo(map);
        });

        // „Éû„Éº„Ç´„Éº„Éï„Ç£„É´„Çø„É™„É≥„Ç∞Ê©üËÉΩ
        let currentFilter = 'all';
        
        function filterMarkers(status) {
            if (currentFilter === status) {
                // Âêå„Åò„Éï„Ç£„É´„Çø„Éº„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Åü„ÇâÂÖ®Ë°®Á§∫„Å´Êàª„Åô
                Object.values(markerGroups).forEach(group => {
                    group.addTo(map);
                });
                currentFilter = 'all';
            } else {
                // ÈÅ∏Êäû„Åó„Åü„Çπ„ÉÜ„Éº„Çø„Çπ„ÅÆ„Éû„Éº„Ç´„Éº„ÅÆ„ÅøË°®Á§∫
                Object.keys(markerGroups).forEach(key => {
                    if (key === status) {
                        markerGroups[key].addTo(map);
                    } else {
                        map.removeLayer(markerGroups[key]);
                    }
                });
                currentFilter = status;
            }
        }

        // ÁâπÂÆö„ÅÆÊ®πÊú®„Å´„Éï„Ç©„Éº„Ç´„Çπ
        function focusTree(lat, lng) {
            map.setView([lat, lng], 18, {
                animate: true,
                duration: 0.5
            });
            
            // Ë©≤ÂΩì„Åô„Çã„Éû„Éº„Ç´„Éº„ÅÆ„Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„ÇíÈñã„Åè
            markerGroups['danger'].eachLayer(layer => {
                if (layer.getLatLng().lat === lat && layer.getLatLng().lng === lng) {
                    layer.openPopup();
                }
            });
            markerGroups['warning'].eachLayer(layer => {
                if (layer.getLatLng().lat === lat && layer.getLatLng().lng === lng) {
                    layer.openPopup();
                }
            });
        }

        // Ë©≥Á¥∞„É¨„Éù„Éº„ÉàË°®Á§∫Ôºà‰ªÆ„ÅÆÂÆüË£ÖÔºâ
        function showDetails(id) {
            alert(`Ê®πÊú® ${id} „ÅÆË©≥Á¥∞„É¨„Éù„Éº„Éà„ÇíË°®Á§∫„Åó„Åæ„Åô„ÄÇ\nÔºàÂÆüÈöõ„ÅÆÂÆüË£Ö„Åß„ÅØÂà•ÁîªÈù¢„ÇÑ„É¢„Éº„ÉÄ„É´„ÅßË©≥Á¥∞ÊÉÖÂ†±„ÇíË°®Á§∫Ôºâ`);
        }

        // „É¢„Éê„Ç§„É´ÂØæÂøú„ÅÆÂá¶ÁêÜ
        function checkMobile() {
            const mobilePanel = document.querySelector('.mobile-panel');
            if (window.innerWidth <= 768) {
                mobilePanel.style.display = 'block';
            } else {
                mobilePanel.style.display = 'none';
            }
        }

        window.addEventListener('resize', checkMobile);
        checkMobile();

        // Âú∞Âõ≥„ÅÆ„Çµ„Ç§„Ç∫Ë™øÊï¥
        setTimeout(() => {
            map.invalidateSize();
        }, 100);
        });
    </script>
</body>
</html>